// File: prisma/schema.prisma

// --- Model ini seharusnya sudah ada dari sebelumnya ---
model DeviceExternal {
  id        String   @id @default(cuid())
  uniqId    String   @unique @default(cuid())
  name      String
  topic     String   @unique
  address   String?
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
  
  // Relasi ke konfigurasi logging
  loggingConfigs LoggingConfiguration[]
}

// --- MODEL BARU UNTUK KONFIGURASI LOGGING ---
model LoggingConfiguration {
  id           String   @id @default(cuid())
  customName   String   // Nama custom dari pengguna, e.g., "Suhu Ruangan"
  key          String   // Key dari JSON payload, e.g., "data.temperature"
  units        String?  // Satuan, e.g., "Â°C"
  multiply     Float?   @default(1) // Faktor pengali
  
  // Relasi ke device external
  deviceUniqId String
  device       DeviceExternal @relation(fields: [deviceUniqId], references: [uniqId])
  
  createdAt    DateTime @default(now())
  updatedAt    DateTime @updatedAt
  
  // Indeks untuk mencegah duplikasi key pada device yang sama
  @@unique([deviceUniqId, key])
}

// --- MODEL BARU UNTUK MENYIMPAN DATA LOG ---
model LoggedData {
  id         String   @id @default(cuid())
  configId   String   // ID dari konfigurasi logging terkait
  value      Float    // Nilai numerik yang disimpan
  timestamp  DateTime @default(now())
  
  // Opcional: Relasi kembali ke konfigurasi
  // config     LoggingConfiguration @relation(fields: [configId], references: [id])
}